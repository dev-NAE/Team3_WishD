<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.teamproject.mapper.ProjectMapper">

    <!-- 전체 프로젝트 등록 개수 가져오기 ( 10개 단위로 )-->
    <!-- 동적 쿼리 이용 => 검색어 있으면 sql 구문 추가 -->
    <select id="selectProject_all" resultType="com.teamproject.domain.ProjectDTO">
        SELECT *
        FROM project_board
        <if test="search != null">
            WHERE pboard_title like CONCAT('%', #{search}, '%')
        </if>
        ORDER BY pboard_date DESC LIMIT #{startRow}, #{endRow};
    </select>

    <!-- 전체 프로젝트 등록 개수 반환 -->
    <!-- 검색어 포함 -->
    <select id="getProjectCount" resultType="int">
        SELECT count(*)
        FROM project_board
        <if test="search != null">
            WHERE pboard_title like CONCAT('%', #{search}, '%')
        </if>;
    </select>

    <!-- 프로젝트 당 등록된 전체 스킬 반환 -->
    <select id="selectProjectSkill" resultType="com.teamproject.domain.ProjectSkillDTO">
        SELECT s.skill_id, s.skill_name
        FROM project_skill p JOIN skills s
        ON p.skill_id = s.skill_id
        WHERE p.pboard_id = #{pboard_id};
    </select>

    <!-- skills 에 있는 모든값 가져오기 -->
    <select id="getProjectSkillList" resultType="com.teamproject.domain.ProjectSkillDTO">
        SELECT skill_name
        FROM skills;
    </select>

<!--    &lt;!&ndash; 특정 스킬이 포함된 프로젝트의 개수 반환 &ndash;&gt;-->
<!--    <select id="getProjectCountBySkill" resultType="int">-->
<!--        SELECT count(DISTINCT p.pboard_id)-->
<!--        FROM project_board p-->
<!--        LEFT JOIN project_skill ps ON p.pboard_id = ps.pboard_id-->
<!--        <where>-->
<!--            <if test="skill_id != null">-->
<!--                ps.skill_id = #{skill_id}-->
<!--            </if>-->
<!--            <if test="search != null">-->
<!--                AND p.pboard_title LIKE CONCAT('%', #{search}, '%')-->
<!--            </if>-->
<!--        </where>-->
<!--    </select>-->

<!--    &lt;!&ndash; 특정 스킬이 포함된 프로젝트 반환 &ndash;&gt;-->
<!--    <select id="selectProjectsBySkill" resultType="com.teamproject.domain.ProjectDTO">-->
<!--        SELECT DISTINCT p.*-->
<!--        FROM project_board p-->
<!--        LEFT JOIN project_skill ps ON p.pboard_id = ps.pboard_id-->
<!--        <where>-->
<!--            <if test="skill_id != null">-->
<!--                ps.skill_id = #{skill_id}-->
<!--            </if>-->
<!--            <if test="search != null">-->
<!--                AND p.pboard_title LIKE CONCAT('%', #{search}, '%')-->
<!--            </if>-->
<!--        </where>-->
<!--        ORDER BY p.pboard_date DESC-->
<!--        LIMIT #{startRow}, #{endRow};-->
<!--    </select>-->

</mapper>
