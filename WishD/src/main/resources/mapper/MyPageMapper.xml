<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.teamproject.mapper.MyPageMapper">
	
	<!-- 일반유저의 user_no 가져오기 -->
	<select id="getNormalMember" resultType="com.teamproject.domain.MemberDTO">
		SELECT *
		FROM user_info
		JOIN user ON user_info.user_no = user.user_no
		WHERE user.user_id = #{user_id}
	</select>
	
	<!-- 간편회원의 user_no 가져오기 -->
	<select id="getSimpleMember" resultType="com.teamproject.domain.MemberDTO">
		select * from user_info join simple_user
		on user_info.user_no = simple_user.user_no
		where access_Token = #{access_Token}
	</select>
	
	<select id="userCheck" resultType="com.teamproject.domain.MemberDTO">
		SELECT * 
		FROM user_info 
		JOIN user ON user_info.user_no = user.user_no
		WHERE user_info.user_no = #{user_no} 
		AND user.user_pass = #{user_pass};
	</select>
		
	<update id="updateMember">
		update user set user_phone = #{user_phone}
		WHERE user_id = #{user_id}
	</update>
	
	<!-- 내프로젝트 가져오기 -->
<!--   	<select id="getMyProject" resultType="com.teamproject.domain.MyProjectDTO"> -->
<!--   		select * from project_board join user_info -->
<!--   		on project_board.user_id = user_info.user_no -->
<!--   		where user_info.user_no = #{user_no} -->
<!--   	</select> -->
  	<select id="getMyProject" resultType="com.teamproject.domain.MyProjectDTO">
			select * from project_board
        	where user_id = #{user_no}
        	<if test="search != null">
        	and pboard_title LIKE CONCAT('%', #{search}, '%')
        	</if>
        	<if test="projectStatus != null">
        	and pboard_state = #{projectStatus}
        	</if>
        	limit #{startRow}, #{endRow};
			
<!--   		select * from project_board  -->
<!--   		where user_id = #{user_no} -->
<!--   		limit #{startRow}, #{endRow} -->
  		
<!--   		select * from project_board join user_info -->
<!--   		on project_board.user_id = user_info.user_no -->
<!--   		where user_info.user_no = #{user_no} -->
<!--   		limit #{startRow}, #{pageSize} -->
  	</select>
  	
  	<select id="getMyProjectSkillList" resultType="com.teamproject.domain.ProjectSkillDTO">
  		SELECT s.*
        FROM project_skill ps JOIN skills s
        ON ps.skill_id = s.skill_id
        WHERE ps.pboard_id = #{pboard_id}
	</select>
	
	<!-- 내 프로젝트글개수 가져오기, 검색어 있으면 검색결과 글개수 반환 -->
	<select id="getProjectCount" resultType="int">
  		select count(*)
  		from project_board
  		where user_id = #{user_no}
  		<if test="search != null">
        AND pboard_title
        LIKE CONCAT('%', #{search}, '%')
    	</if>
    	<if test="projectStatus != null">
        and pboard_state = #{projectStatus}
        </if>
	</select>
	
	<!-- 수정을 위해 프로젝트 하나만 가져오기 -->
	<select id="getProjectForUpdate" resultType="com.teamproject.domain.MyProjectDTO">
		select * from project_board
		where pboard_id = #{projectPageNum}
	</select>
	
</mapper>